C51 COMPILER V9.01   RS232                                                                 07/18/2013 16:21:47 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE RS232
OBJECT MODULE PLACED IN ..\Obj\rs232.obj
COMPILER INVOKED BY: D:\(3)keil4\C51\BIN\C51.EXE ..\..\单片机和PC通信\rs232.c BROWSE DEBUG OBJECTEXTEND PRINT(.\rs232.ls
                    -t) OBJECT(..\Obj\rs232.obj)

line level    source

   1          /******************************************************************************      
   2          * 【语    言】：C语言
   3          * 【编译环境】：Keil4  
   4          * 【程序功能】：通过串口助手向单片机发送数据，然后通过第一位数码管显示，注意：只能发送00~09十个数字。
   5          * 【技术支持】：单片机串口通信; 工作方式1; 波特率为9600bps;                             
   6          * 【晶    振】: 12MHz外部晶振           
   7          * 【芯    片】: stc89C52rc  
   8          * 【日    期】: 2013/7/17
   9          * 【作    者】: 刘亚飞  
  10          ******************************************************************************/
  11          #include<reg52.h>                     //定义头文件
  12          #include<intrins.h>
  13          
  14          #define uchar unsigned char       //宏定义
  15          #define uint  unsigned int
  16          
  17          uchar code tab[] = {0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F,0x00};
  18          uchar disp_buffer[8] = {10,10,10,10,10,10,10,10};
  19          uchar buffer;
  20          /*************************************************/
  21          //延时函数：功能是带有入口参数的延时函数，单位1毫秒
  22          /*************************************************/
  23          void delayms(int m)
  24          {
  25   1              int i,j;
  26   1              for(i=0;i<m;i++)
  27   1              {
  28   2                      for(j=0;j<123;j++)
  29   2                      {}
  30   2              }
  31   1      }
  32          
  33          /******************************************************************************
  34           * 函数名:      数码管显示
  35           * 函数功能:用扫描的方式实现八位数码管的显示 
  36           *
  37           * 输入:  无
  38           * 输出:  无
  39           * 返回值:无
  40           *
  41           * 修改历史:
  42           * --------------------
  43           *.jan., Written By:
  44           * --------------------
  45           ******************************************************************************/
  46          void display()
  47          {
  48   1              uchar i,temp;
  49   1              temp = 0xfe;
  50   1              for(i=0; i<8; i++)
  51   1              {
  52   2                      P2 = temp;
  53   2                      P0 = tab[disp_buffer[i]];
  54   2                      delayms(2);
C51 COMPILER V9.01   RS232                                                                 07/18/2013 16:21:47 PAGE 2   

  55   2                      P0 = 0x00;
  56   2                      temp = _cror_(temp,1);
  57   2              }
  58   1      }
  59          
  60          /******************************************************************************
  61           * 函数名: 接收数据
  62           * 函数功能: 单片机接收PC机通过串口发送的数据
  63           *
  64           * 输入: 无
  65           * 输出: 无
  66           * 返回值:无
  67           *
  68           * 修改历史:
  69           * --------------------
  70           *.jan., Written By:
  71           * --------------------
  72           ******************************************************************************/
  73          void receive()
  74          {
  75   1              if(RI == 1)               //当接收完一帧数据后RI被硬件置1
  76   1                      {
  77   2                              RI = 0;   //通过软件把RI置0，以便再次接收数据
  78   2                              buffer = SBUF;  //读取SBUF中接收到的数据
  79   2                      }                               
  80   1      }
  81          /**************************************************/
  82          //主函数
  83          /**************************************************/
  84          void main()
  85          {
  86   1              SCON = 0x70;    //选择方式1，允许接收
  87   1              PCON = 0x80;    //SMOD=1,波特率加倍
  88   1              TMOD = 0x20;    //定时器1工作在方式2
  89   1              TH1 = 0xFA;
  90   1              TL1 = 0xFA;
  91   1              TR1 = 1;                 //打开定时器1
  92   1              while(1)
  93   1              {
  94   2                      receive();
  95   2                      disp_buffer[0] = buffer;
  96   2                      display();      
  97   2              }
  98   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    122    ----
   CONSTANT SIZE    =     11    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
