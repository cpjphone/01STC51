C51 COMPILER V9.01   SHUANG595                                                             07/28/2013 23:32:37 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE SHUANG595
OBJECT MODULE PLACED IN shuang595.OBJ
COMPILER INVOKED BY: D:\(3)keil4\C51\BIN\C51.EXE shuang595.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************      
   2          * 【语    言】：C语言
   3          * 【编译环境】：Keil4  
   4          * 【程序功能】：双595驱动数码管
   5          * 【技术支持】：定时器中断方式0 、595                           
   6          * 【晶    振】: 12MHz外部晶振           
   7          * 【芯    片】: STC89C52RC 
   8          * 【日    期】: 2013/7/28
   9          * 【作    者】: Phone
  10          * 【编程理念】: 死东西活用，活东西套用。
  11          *********************************************************************************/
  12          
  13          #include<reg52.h>                                
  14          #include<intrins.h>                                       //定义头文件
  15          
  16          #define uchar unsigned char                     
  17          #define uint unsigned int                         //宏定义
  18          #define  NOP() _nop_()                            // 定义空指令 
  19          
  20          sbit MOSIO =P3^4;                                         //串行数据线
  21          sbit R_CLK =P3^5;                                         //数据并行输出控制
  22          sbit S_CLK =P3^6;                                         //串行时钟线
  23          
  24          uchar sec,min,hour,count ;                        //定义时分秒 时间变量
  25          
  26          /************************************************************************/
  27          //（活东西）显示缓存
  28          /************************************************************************/
  29          uchar disp_buffer[8]={0};
  30          
  31          /************************************************************************/
  32          //（死东西）可调用数组
  33          /************************************************************************/
  34          uchar code tab[] = {
  35          0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F,0x40,0x80,0x00};
  36          
  37          /************************************************************************/
  38          //595 驱动
  39          /************************************************************************/
  40          void HC595SendData(unsigned int SendVal)
  41          {  
  42   1              unsigned char i;
  43   1              
  44   1              
  45   1              for(i=0;i<8;i++) 
  46   1              {
  47   2                      if((SendVal<<i)&0x80)
  48   2                              MOSIO=1;                                        //set dataline high  0X80  最高位与SendVal左移的最高位 进行逻辑运算
  49   2                      else MOSIO=0;                               // 如果为真 MOSIO = 1  
  50   2                      
  51   2                      S_CLK=0;  
  52   2                      NOP();                                                  //短暂延时产生一定宽度的脉冲信号
  53   2                      NOP();                                                  //短暂延时、上升沿读取数据
  54   2                      S_CLK=1;
  55   2              
C51 COMPILER V9.01   SHUANG595                                                             07/28/2013 23:32:37 PAGE 2   

  56   2              }
  57   1                      
  58   1      }
  59          
  60          /************************************************************************/
  61          //595 驱动 开关
  62          /************************************************************************/
  63          void HC595out()
  64          {
  65   1                      R_CLK=0;                                                //set dataline low
  66   1                      NOP();                                                  //短暂延时
  67   1                      NOP();                                                  //短暂延时、上升沿读取数据
  68   1                      R_CLK=1; 
  69   1      }
  70          
  71          /************************************************************************/
  72          //延时函数
  73          /************************************************************************/
  74          void delayms(uint ms)
  75          {
  76   1              uint i,j;  
  77   1              for(i=0;i<ms;i++)
  78   1                      for(j=0;j<121;j++);
  79   1      }
  80          
  81          /************************************************************************/
  82          //数码管显示函数
  83          /************************************************************************/
  84          void display()
  85          {
  86   1              uchar i,temp;
  87   1              temp = 0xfe;
  88   1              for(i=0;i<8;i++)
  89   1              {
  90   2                      
  91   2                      HC595SendData(tab[disp_buffer[i]]);
  92   2                      HC595SendData(temp);
  93   2                      HC595out();
  94   2      //              delayms(5);
  95   2      //              
  96   2      //              HC595SendData(0x00);
  97   2      //              HC595SendData(0xff);
  98   2                      HC595out();
  99   2                      temp = _crol_(temp,1);                            //因为移位与放段同时，故i 是几，就送到哪位去。
 100   2              }                         
 101   1      }
 102          /************************************************************************/
 103          //主函数
 104          /************************************************************************/
 105          void main()
 106          {
 107   1              uint HC595SendVal;
 108   1              char i;
 109   1              EA = 1;
 110   1              ET0 =1;
 111   1              TMOD = 0x01;
 112   1              TH0 = (65536-50000)/256;//0x3c;
 113   1              TL0 = (65536-50000)%256;//0xb0;
 114   1              TR0 = 1;
 115   1              while(1)
 116   1              {       
 117   2                              
C51 COMPILER V9.01   SHUANG595                                                             07/28/2013 23:32:37 PAGE 3   

 118   2                              disp_buffer[2] = 10;
 119   2                              disp_buffer[5] = 11;
 120   2                              disp_buffer[1] = hour%10;
 121   2                              disp_buffer[0] = hour/10;
 122   2                              disp_buffer[4] = min%10;
 123   2                              disp_buffer[3] = min/10;
 124   2                              disp_buffer[7] = sec%10;
 125   2                              disp_buffer[6] = sec/10;                
 126   2                              for(i = 0;i < 5;i--)
 127   2                              display();
 128   2      
 129   2      
 130   2      
 131   2      
 132   2      
 133   2              }
 134   1      }
*** WARNING C280 IN LINE 107 OF SHUANG595.C: 'HC595SendVal': unreferenced local variable
 135          /************************************************************************/
 136          //中断服务函数：用于计数时、分、秒
 137          /************************************************************************/
 138          void timer0() interrupt 1
 139          {
 140   1              TH0 = (65536-50000)/256;//0x3c;
 141   1              TL0 = (65536-50000)%256;//0xb0;
 142   1              count++;
 143   1              if(count > 19)
 144   1              {
 145   2                      count = 0;              
 146   2                              sec++;
 147   2                      if(sec > 59)
 148   2                      {
 149   3                              sec = 0;
 150   3                              min++;
 151   3                              if(min > 59)
 152   3                              {
 153   4                                      min = 0;
 154   4                                      hour++;
 155   4                                      if(hour > 23)
 156   4                                              hour = 0;
 157   4                              }
 158   3                      }       
 159   2              }       
 160   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    281    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
