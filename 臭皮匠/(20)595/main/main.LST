C51 COMPILER V9.01   MAIN                                                                  07/28/2013 15:53:23 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\(3)keil4\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************      
   2          * 【语    言】：C语言
   3          * 【编译环境】：Keil4  
   4          * 【程序功能】：8*8点阵流动显示时钟
   5          * 【技术支持】：定时器中断方式0 、595                           
   6          * 【晶    振】: 12MHz外部晶振           
   7          * 【芯    片】: STC89C52RC 
   8          * 【日    期】: 2013/6/12
   9          * 【作    者】: Phone
  10          *********************************************************************************/
  11          
  12          #include<reg52.h>                                //定义头文件
  13          #include<intrins.h>
  14          #define uchar unsigned char                     
  15          #define uint unsigned int                                                //宏定义
  16          
  17          uchar count,flag_t;                                                              //定义计数变量与标志位
  18          char sec,min = 57,hour = 12;                                     //定义时分秒 时间变量
  19          
  20          /************************************************************************/
  21          //（活东西）显示函数缓存空间
  22          /************************************************************************/
  23          uchar disp_buffer[8];
  24          
  25          /************************************************************************/
  26          //（死东西）显示函数缓存空间
  27          /************************************************************************/
  28          uchar code xin[6][8]={
  29          {0x00,0x00,0x00,0x20,0x10,0x20,0x00,0x00},
  30          {0x00,0x00,0x10,0x20,0x10,0x20,0x10,0x00},
  31          {0x00,0x00,0x18,0x20,0x10,0x20,0x18,0x00},
  32          {0x00,0x00,0x18,0x24,0x10,0x24,0x18,0x00},
  33          {0x00,0x00,0x18,0x24,0x12,0x24,0x18,0x00},
  34          {0x00,0x00,0x18,0x3C,0x1E,0x3C,0x18,0x00},               /***"心形"***/ 
  35          };
  36          
  37          /************************************************************************/
  38          //（活东西）可变缓存空间，用于存放数据变换的时钟数据
  39          /************************************************************************/
  40          uchar disp_shizhong2[66];
  41          
  42          /************************************************************************/
  43          //（死东西）可调用数组
  44          /************************************************************************/
  45          uchar code tab[12][8]={
  46          {0x00,0x00,0x3e,0x41,0x41,0x41,0x3e,0x00}, //0
  47          
  48          {0x00,0x00,0x00,0x00,0x21,0x7f,0x01,0x00}, //1
  49          
  50          {0x00,0x00,0x27,0x45,0x45,0x45,0x39,0x00}, //2
  51          
  52          {0x00,0x00,0x22,0x49,0x49,0x49,0x36,0x00}, //3
  53          
  54          {0x00,0x00,0x0c,0x14,0x24,0x7f,0x04,0x00}, //4
  55          
C51 COMPILER V9.01   MAIN                                                                  07/28/2013 15:53:23 PAGE 2   

  56          {0x00,0x00,0x72,0x51,0x51,0x51,0x4e,0x00}, //5
  57          
  58          {0x00,0x00,0x3e,0x49,0x49,0x49,0x26,0x00}, //6
  59          
  60          {0x00,0x00,0x40,0x40,0x40,0x4f,0x70,0x00}, //7
  61          
  62          {0x00,0x00,0x36,0x49,0x49,0x49,0x36,0x00}, //8
  63          
  64          {0x00,0x00,0x32,0x49,0x49,0x49,0x3e,0x00}, //9
  65          
  66          {0x00,0x00,0x00,0x66,0x66,0x00,0x00,0x00}, //:
  67          };
  68          
  69          /************************************************************************/
  70          //声明595驱动函数
  71          /************************************************************************/
  72          void HC595SendData(unsigned char SendVal);
  73            
  74          /************************************************************************/
  75          //延时函数：功能带有入口参数的延时函数，时间单位1毫秒
  76          /************************************************************************/
  77          void delayms(int m)
  78          {
  79   1          int i,j;
  80   1          for(i=0;i<m;i++)
  81   1          {
  82   2              for(j=0;j<123;j++)
  83   2              {}
  84   2          }
  85   1      }
  86          
  87          /************************************************************************/
  88          //点阵显示函数：595数据到行（实数）、P2口送扫描数据
  89          /************************************************************************/
  90          void display()
  91          {
  92   1          uchar i,temp,HC595SendVal;
  93   1          temp = 0xfe;
  94   1          for(i=0;i<8;i++)
  95   1          {
  96   2              P2 = temp;
  97   2              HC595SendVal = disp_buffer[i];
  98   2                      HC595SendData(HC595SendVal);
  99   2              delayms(2);
 100   2              HC595SendVal = 0;
 101   2                      HC595SendData(HC595SendVal);
 102   2              temp = _crol_(temp,1);  
 103   2          }
 104   1      }
 105          
 106          
 107          /************************************************************************/
 108          //主函数
 109          /************************************************************************/
 110          void main()
 111          {
 112   1          uchar k,m,n,i,j,con=0;
 113   1              EA = 1;                                 //开 总中断
 114   1              ET0 =1;                                 //开 计算器0 中断
 115   1              TMOD = 0x01;                    //设置 计算器工作模式为 方式1、16位计数
 116   1              TH0 = (65536-50000)/256;//0x3c（高位装初值）;
 117   1              TL0 = (65536-50000)%256;//0xb0（低位装初值）;
C51 COMPILER V9.01   MAIN                                                                  07/28/2013 15:53:23 PAGE 3   

 118   1              TR0 = 1;                                //启动 定时器0中断                                                 
 119   1          while(1)
 120   1          {                                           
 121   2                                      for(k=0; k<8;k++)
 122   2                                      {
 123   3                                              disp_shizhong2[k] = tab[hour/10][k];
 124   3                                              disp_shizhong2[8+k] = tab[hour%10][k];
 125   3                                              disp_shizhong2[16+k] = tab[10][k];
 126   3                                              disp_shizhong2[24+k] = tab[min/10][k];
 127   3                                              disp_shizhong2[32+k] = tab[min%10][k];
 128   3                                              disp_shizhong2[40+k] = tab[10][k];
 129   3                                              disp_shizhong2[48+k] = tab[sec/10][k];
 130   3                                              disp_shizhong2[56+k] = tab[sec%10][k];                                                                  
 131   3                                      }                                                               
 132   2                                                              //可变时钟数据存储到缓存空间 disp_shizhong2[66]
 133   2                                                                                                                                      
 134   2                                      
 135   2                                      if(con>7)   //每一屏显示时间
 136   2                                              {
 137   3                                                      con=0;
 138   3                                                      n++;
 139   3                                                      if(n>64)
 140   3                                                              n=0;                                    
 141   3                                              }
 142   2                                                          //显示64屏
 143   2                                      if(n<63)
 144   2                                              {               
 145   3                                                      for(m=0;m<8;m++) 
 146   3                                                      {
 147   4                                                              disp_buffer[m] = disp_shizhong2[m+n];                                                   
 148   4                                                      }
 149   3                                                      display();
 150   3                                                      
 151   3                                              }
 152   2                                                         //时钟显示函数
 153   2                                                                               
 154   2                                      if((n>63)&(con<2))
 155   2                                              {
 156   3                                                       for(i = 0;i < 6;i++)
 157   3                                                       {
 158   4                                                              for(m=0;m<8;m++) 
 159   4                                                              {
 160   5                                                                      disp_buffer[m] = xin[i][m];
 161   5                                                              }
 162   4                                                              for(j = 0;j < 15; j++)
 163   4                                                              display();
 164   4                                                      }                                               
 165   3                                              }
 166   2                                                         //心形显示函数
 167   2                                      con++;
 168   2                                                                                                                                                                                                                                                                                                                              
 169   2              }
 170   1                                                                                                   
 171   1      }
 172          
 173          /************************************************************************/
 174          //中断服务函数：用于计数时、分、秒
 175          /************************************************************************/
 176          void timer0() interrupt 1
 177          {
 178   1              TH0 = (65536-50000)/256;//0x3c;
 179   1              TL0 = (65536-50000)%256;//0xb0;
C51 COMPILER V9.01   MAIN                                                                  07/28/2013 15:53:23 PAGE 4   

 180   1              count++;
 181   1              if(count > 19)
 182   1              {
 183   2                      count = 0;
 184   2                      if(flag_t == 0)
 185   2                              sec++;
 186   2                      if(sec > 59)
 187   2                      {
 188   3                              sec = 0;
 189   3                              min++;
 190   3                              if(min > 59)
 191   3                              {
 192   4                                      min = 0;
 193   4                                      hour++;
 194   4                                      if(hour > 23)
 195   4                                              hour = 0;
 196   4                              }
 197   3                      }       
 198   2              }       
 199   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    701    ----
   CONSTANT SIZE    =    144    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     79       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
