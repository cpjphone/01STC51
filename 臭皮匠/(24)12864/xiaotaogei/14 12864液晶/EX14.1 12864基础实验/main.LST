C51 COMPILER V9.01   MAIN                                                                  03/19/2014 21:06:26 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\(7)KEIL\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //公司：北方蓝芯科技开发有限公司
   2          //网址：www.hrbnbc.com
   3          //更多教程可登陆技术论坛www.hrbnbc.com/bbs对应版块下载，
   4          //所有教程一律免费下载
   5          /***************************************************************************************************    
   6          工程名称：      12864
   7          功能描述：  实现12864液晶显示，液晶第一行显示"  北方蓝芯科技  "，第二行显示" www.hrbnbc.com "
   8                                         液晶第三行显示"请登录技术论坛："，第四行显示" hrbnbc.com/bbs "
   9          硬件连接：  将12864液晶接口对应插接到P2接口，注意1-20脚不要插反。
  10          维护记录：  2011-8-22
  11          ***************************************************************************************************/
  12          #include "reg51.h"          //包含头文件
  13          #define uchar unsigned char
  14          #define uint  unsigned int
  15          
  16          sbit RS=P2^5;    //命令/数据选择
  17          sbit RW=P2^4;    //读写口
  18          sbit  E=P2^3;    //锁存控制
  19          sbit RES = P2^0; //复位
  20          sbit PSB = P2^2; //串并选择
  21          //**************************************************************************************************
  22          //延时函数
  23          //**************************************************************************************************
  24          delay(uint time)         //int型数据为16位,所以最大值为65535            
  25           {
  26   1        uint  i,j;             //定义变量i,j,用于循环语句 
  27   1        for(i=0;i<time;i++)    //for循环,循环50*time次
  28   1           for(j=0;j<100;j++); //for循环,循环50次
  29   1       }
  30          //**************************************************************************************************
  31          //查忙
  32          //**************************************************************************************************
  33          checkbusy()           
  34          {
  35   1         RS=0;                   //命令/数据选择,为0时选择命令    
  36   1         RW=1;                   //读/写选择，为1时选择读
  37   1         E=1;                    //使能
  38   1         while((P0&0x80)==0x80); //查忙标志位，等待标志位为0，即表示写入完毕
  39   1         E=0;                    //关闭读写 
  40   1      }
  41          //**************************************************************************************************
  42          //向LCD写一命令
  43          //**************************************************************************************************
  44          wcode(uchar cmdcode)
  45          {
  46   1         checkbusy();            //查忙
  47   1         RS=0;                   //命令/数据选择,为0时选择命令 
  48   1         RW=0;                   //读/写选择，为0时选择写
  49   1         E=1;                    //使能
  50   1         P0=cmdcode;             //送入命令
  51   1         delay(10);              //等待写入 
  52   1         E=0;                    //关闭读写
  53   1      }
  54          //**************************************************************************************************
  55          //向LCD写一数据
C51 COMPILER V9.01   MAIN                                                                  03/19/2014 21:06:26 PAGE 2   

  56          //**************************************************************************************************
  57          wdata(uchar dispdata)
  58          {
  59   1         checkbusy();            //查忙
  60   1         RS=1;                   //命令/数据选择,为1时选择数据
  61   1         RW=0;                   //读/写选择，为0时选择写
  62   1         E=1;                    //使能
  63   1         P0=dispdata;            //送入数据
  64   1         delay(10);              //等待写入 
  65   1         E=0;                    //关闭读写
  66   1      }
  67          //**************************************************************************************************
  68          //LCD 初始化
  69          //**************************************************************************************************
  70          InitLCD()
  71             {
  72   1         PSB=1;             //设置为8BIT并口工作模式
  73   1         RES=0;             //复位
  74   1         delay(10);         //延时
  75   1         RES=1;             //关复位 
  76   1         wcode(0x30);       //选择基本指令集
  77   1         wcode(0x0c);       //开显示(无游标、不反白)
  78   1         wcode(0x01);       //清除显示，并且设定地址指针为00H
  79   1         wcode(0x06);       //指定在资料的读取及写入时，设定游标的移动方向及指定显示的移位    
  80   1         }  
  81          //**************************************************************************************************
  82          //任意位置显示字符串
  83          //**************************************************************************************************
  84          void dis(uchar x,uchar y,uchar code *s)   
  85          {                                     //x为横坐标，y位纵坐标，*s表示指针，为数据的首地址
  86   1       switch(y)                            //选择纵坐标            
  87   1           { 
  88   2                case 0: wcode(0x80+x);break;    //第1行
  89   2                case 1: wcode(0x90+x);break;    //第2行
  90   2                case 2: wcode(0x88+x);break;    //第3行
  91   2                case 3: wcode(0x98+x);break;    //第4行
  92   2            default:break;
  93   2               }
  94   1         while(*s>0)                        //写入数据，直到数据为空
  95   1           {  
  96   2            wdata(*s);                      //写数据
  97   2            delay(10);                      //等待写入
  98   2            s++;                            //下一字符
  99   2           }
 100   1      }
 101          //**************************************************************************************************
 102          //主函数
 103          //**************************************************************************************************
 104          main()
 105          {  
 106   1         InitLCD();                        //初始化液晶
 107   1         while(1)                          //进入死循环，防止看门狗复位
 108   1          {
 109   2           dis(0,0,"  北方蓝芯科技  ");    //显示第1行
 110   2           dis(0,1," www.hrbnbc.com ");    //显示第2行
 111   2           dis(0,2,"请登录技术论坛：");    //显示第3行
 112   2           dis(0,3," hrbnbc.com/bbs ");    //显示第4行
 113   2           delay(5000);                    //保持显示一段时间
 114   2           wcode(0x01);                    //清屏
 115   2          }
 116   1      }
*** WARNING C290 IN LINE 29 OF MAIN.C: missing return value
C51 COMPILER V9.01   MAIN                                                                  03/19/2014 21:06:26 PAGE 3   

*** WARNING C290 IN LINE 40 OF MAIN.C: missing return value
*** WARNING C290 IN LINE 53 OF MAIN.C: missing return value
*** WARNING C290 IN LINE 66 OF MAIN.C: missing return value
*** WARNING C290 IN LINE 80 OF MAIN.C: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    240    ----
   CONSTANT SIZE    =     68    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  5 WARNING(S),  0 ERROR(S)
